# 🛠️ 퍼시스 CRM 고도화 – 데이터 흐름 및 설계 개요

본 프로젝트는 퍼시스 CRM 시스템의 데이터를 수신 및 적재하고, 이를 분석용 데이터로 전환하는 **자동화된 파이프라인**을 구축하는 것이 주요 목표였습니다.  
특히 Snowflake의 Task 기능과 저장 프로시저를 연동하여, **스케줄 기반의 안정적인 적재 환경**을 구현했습니다.

---

### 🔄 전체 데이터 흐름 요약

```
Kafka → Snowflake Stage Table → 변환 프로시저 → ODS / 분석 마트 → BI 도구(Tableau)
```

1. **Kafka 수신**  
   - CRM 시스템에서 Kafka를 통해 송신되는 데이터를 수신 (Kafka 소비는 사내 파이프라인 활용)

2. **1차 적재 (Stage 테이블)**  
   - 수신된 데이터를 Snowflake Stage Table에 저장

3. **변환 및 적재 (저장 프로시저)**  
   - Snowflake 내 저장 프로시저에서 데이터를 가공하여 ODS 테이블 및 마트 테이블로 분배
   - 사용된 주요 프로시저 예: `SP_ERP_TO_ORDDET`, `SP_ERP_TO_ORDMAS`, `SP_PRC_TO_ORDMAS_SF`

4. **자동화 (Task + Task Graph)**  
   - `Root Task`가 기준이 되는 스케줄(Task)로 등록되어 있으며, 각 Task가 **Child Task**를 호출하는 구조로 자동 실행  
   - 실행 이력은 `TIME_MNG` 테이블에 저장되어 모니터링 및 조건 분기용으로 사용됨

---

### 🔧 주요 구성 요소

| 구성 요소 | 설명 |
|-----------|------|
| **Snowflake Task** | 정해진 시간에 프로시저 실행 (`00~05시 정기 수행`) |
| **저장 프로시저** | 데이터 변환 및 적재 작업 자동화 |
| **Task Graph** | Root/Child 구조로 계층화된 적재 흐름 관리 |
| **TIME_MNG 테이블** | 각 Task 실행 이력을 기록하고, 다음 실행의 기준 파라미터로 사용됨 |

---

### ✅ 설계 포인트 및 효과

- **변환 로직의 재사용성과 안정성 확보**: 모듈화된 프로시저로 유지보수 용이
- **시간 기반 자동화**: Task + Task Graph 조합으로 수동 개입 없이 운영 가능
- **이력 관리 및 문제 추적 용이**: TIME_MNG 테이블을 통한 실행 이력 분석 가능
